<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <link rel="stylesheet" href="../bootstrap-3.3.7-dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../css/car.css">
    <script type="text/javascript" src="../js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
        $(function () {
            $.ajax({
                url: '../car',
                dataType: 'json',
                type: 'post',
                success: function (data) {
                    console.log(data)
                    //说明商品未加入到购物车
                    for (var i = 0; i < data.length; i++) {
                        var num = i + 1;
                        var node = "<tr><td>" + num + "</td>" +
                            "<td>" + data[i].name + "</td>" +
                            "<td>" + data[i].price + "</td>" +
                            "<td><input type='button' οnclick='decrease(this)' value='-' class='minus'/>" +
                            "<input type='text' size='3' value='1' class='num' />" +
                            "<input type='button' οnclick='increase(this)' value='+' class='plus' />" + "</td>" +
                            "<td>" + "<span type='text' size='3' class='total'>" + data[i].price + "</span>" + "</td>" +
                            "<td><button type='button' class='btn1 btn-danger' onclick='delete(this)' >删除</button>" +
                            "<button type='button' class='btn2 btn-success' onclick='payment(this)'>付款</button>" +
                            "</td>" + "</tr>";
                        $('#cat_row').append(node);
                    }
                    //给动态生成的标签绑定事件
                    //加
                    $(document).on("click", ".plus", function () {
                        $('.num').val(parseInt($('.num').val()) + 1)
                        if (parseInt($('.num').val())>64){

                        }
                    })
                    //减
                    $(document).on("click", ".minus", function () {
                        $('.num').val(parseInt($('.num').val()) - 1)
                    })
                    //设置购物数量
                    $(document).on("keyup",".num",function () {
                        //当数字不合法的时候自动变成1，合法数字为1-64
                        var obj = $(".num");
                        var userInput = obj.val()
                        //正则表达式，第一个是【1-9】中的数组，第二个可以有也可以没有
                        var regExp = /^[1-9][0-9]*$/;
                        var ok = regExp.test(userInput);
                        if (!ok) {
                            obj.val(1);
                        } else {
                            if (userInput > 64) {
                                obj.val(1);
                            }
                        }
                    })
                    //删除购物车
                    $(document).on("click",".btn1",function () {
                        $(this).parent('td').parent('tr').remove()
                    })
                    //提交订单
                    $(document).on("click",".btn2",function (){
                        location.href = 'welcome.html'
                    })
                }
            })
        })
    </script>
</head>
<body>
<div id="head">
    <script>
        $("#head").load("head.html")
    </script>
</div>
<div id="car_table" style="border: orangered solid 1px">
    <table class="table table-hover table-striped">
        <thead>
        <tr>
            <td>序号</td>
            <td>商品名称</td>
            <td>单价</td>
            <td>数量</td>
            <td>总价</td>
            <td>操作</td>
        </tr>
        </thead>
        <tbody id="cat_row">
        <tr>
        </tr>
        </tbody>
    </table>
</div>
<div id="foot">
    <script>
        $("#foot").load("foot.html")
    </script>
</div>
</body>
</html>